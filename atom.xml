<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://jiangjinxinn.github.io/</id>
    <title>ç©ºè°ƒæˆ¿</title>
    <updated>2020-04-06T07:42:44.133Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://jiangjinxinn.github.io/"/>
    <link rel="self" href="https://jiangjinxinn.github.io/atom.xml"/>
    <logo>https://jiangjinxinn.github.io/images/avatar.png</logo>
    <icon>https://jiangjinxinn.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, ç©ºè°ƒæˆ¿</rights>
    <entry>
        <title type="html"><![CDATA[Netty å¢å¼ºå†™ FlushConsolidationHandler]]></title>
        <id>https://jiangjinxinn.github.io/post/netty-zeng-qiang-xie/</id>
        <link href="https://jiangjinxinn.github.io/post/netty-zeng-qiang-xie/">
        </link>
        <updated>2020-02-06T06:33:13.000Z</updated>
        <content type="html"><![CDATA[<p>å¦‚æœè¿½æ±‚ååé‡ï¼Œå¯ä»¥ä¸ç”¨ ctx.writeAndFlush()ï¼Œè¿™ç§å†™æ•°æ®æ˜¯åœ¨æ¯æ¬¡ write åéƒ½ç«‹å³ flushï¼ŒåŠ æ€¥å†™æ•°æ®ã€‚</p>
<p>åœ¨ FlushConsolidationHandler ç±»çš„æ³¨é‡Šä¸Šæœ‰è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<p>Flush operations are generally speaking expensive as these may trigger a syscall on the transport level. Thus it is in most cases (where write latency can be traded with throughput) a good idea to try to minimize flush operations as much as possible.</p>
</blockquote>
<p>ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªå¢å¼ºå†™çš„ Netty çš„ FlushConsolidationHandleræ¥å¤„ç†è¿™ä¸ªäº‹æƒ…ï¼Œè¿™ä¸ª Handler æœ‰ä¸€ä¸ªå‚æ•° explicitFlushAfterFlushes å¯ä»¥æ§åˆ¶æ‹¦æˆªå‡ æ¬¡ flush åæ‰è¿›è¡ŒçœŸæ­£çš„ flushæ“ä½œã€‚</p>
<p>è¿™é‡Œæåˆ° FlushConsolidationHandler å¯ä»¥æ‹¦æˆªï¼Œé‚£ä¹ˆä¸ç”¨æƒ³ï¼Œè‚¯å®šæ˜¯ç»§æ‰¿äº† ChannelDuplexHandlerã€‚</p>
<p>è¿™é‡Œä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨æ·»åŠ  FlushConsolidationHandler è®¾å®šäº† explicitFlushAfterFlushes ä¹‹åçœ‹ï¼Œå¦‚æœ flush æ¬¡æ•°ä¸å¤Ÿéš¾é“å°±ä¸€ç›´ä¸ flush å‡ºå»äº†ï¼Œéœ€è¦ç­‰åˆ°åè¾¹ä¸€æ¬¡è¯·æ±‚è¿›æ¥çš„å‡ºç«™äº‹ä»¶åˆ°æ¥å flush å¤Ÿäº†æ‰èƒ½å†™å—ï¼Ÿ</p>
<p>è¿™ä¸ªé—®é¢˜è‚¯å®šä¸æ˜¯çš„ï¼Œå¦‚æœæ˜¯çš„è¯å°±æ˜¯ä¸ªä¸¥é‡çš„ç¼ºé™·çš„ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜æˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ FlushConsolidationHandler æºç æ¥è¯´æ˜ä¸‹</p>
<p>å…³é”®ç‚¹åœ¨ flush æ–¹æ³•ä¸Šï¼Œéœ€è¦è¯´æ˜çš„æ˜¯åœ¨ä»»æ„ä¸€ä¸ª ctx ä¸Šæ‰§è¡Œ flush çš„æ—¶å€™ï¼Œä¼šæ ¹æ® pipeline ä¸Šè®¾ç½®çš„ ChannelHandlerContextï¼Œå¯»æ‰¾ä¸‹ä¸€ä¸ª outBoundHandler ä¼ é€’ä¸‹å»ï¼Œåˆ° FlushConsolidationHandler æ—¶å€™å°±ä¼šè¢«æ‹¦æˆªä¸‹æ¥</p>
<pre><code>@Override
public void flush(ChannelHandlerContext ctx) throws Exception {
    if (readInProgress) {
        // If there is still a read in progress we are sure we will see a channelReadComplete(...) call. Thus
        // we only need to flush if we reach the explicitFlushAfterFlushes limit.
        if (++flushPendingCount == explicitFlushAfterFlushes) {
            flushNow(ctx);
        }
    } else if (consolidateWhenNoReadInProgress) {
        // Flush immediately if we reach the threshold, otherwise schedule
        if (++flushPendingCount == explicitFlushAfterFlushes) {
            flushNow(ctx);
        } else {
            scheduleFlush(ctx);
        }
    } else {
        // Always flush directly
        flushNow(ctx);
    }
}
</code></pre>
<p>Netty æºç ä¸Šçš„æ³¨è§£å·²ç»å¾ˆå¥½çš„è¯´æ˜äº†ï¼Œæœ‰ä¸€ä¸ªå˜é‡ readInProgress æ ‡è¯†æ˜¯å¦æ­£åœ¨è¯»ï¼ˆå³è¯»äº‹ä»¶æœªç»“æŸï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆä¸æŸ¥çœ‹ consolidateWhenNoReadInProgress è¿™ä¸ªåˆ†æ”¯ã€‚å¦‚æœ readInProgress æ ‡è®°æ­£åœ¨è¯» FlushConsolidationHandler å°±ä¼šè¿›è¡Œç»§ç»­è¿›è¡Œæ‹¦æˆªï¼Œç›´åˆ° flush æ¬¡æ•°æ»¡è¶³äº†åæ‰ä¼šè¿›è¡Œæœ€åçš„ flushï¼Œè¯»äº‹ä»¶å·²ç»ç»“æŸçš„è¯ç›´æ¥è°ƒç”¨æœ€åçš„ flush</p>
<p>è¿™å°±è§£ç­”äº†ä¸Šé¢çš„é—®é¢˜ï¼Œå¦‚æœ flush æ¬¡æ•°ä¸å¤Ÿï¼Œä½†æ˜¯è¯»äº‹ä»¶å·²ç»ç»“æŸäº†ï¼Œä¾ç„¶ä¼šè¿›è¡Œ flushã€‚</p>
<p>è¿™æ—¶ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æ„Ÿè§‰è¿™ä¸ª FlushConsolidationHandler æ²¡ä»€ä¹ˆç”¨ï¼Œå› ä¸ºä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘åªè¦ä¸è°ƒç”¨ ctx.writeAndFlush() å³å¯ï¼Œåªè°ƒç”¨ ctx.write ()ï¼Œç„¶åå†åç»­ flush æ‰ã€‚</p>
<p>å¯¹çš„ï¼Œè¿™ä¸ªåœ¨ Netty çš„å®˜æ–¹ demo ä¸­å°±æ˜¯è¿™æ ·å®ä¾‹çš„ï¼Œåªåœ¨è¯»äº‹ä»¶ç»“æŸåæ‰è¿›è¡Œ ctx.flush()</p>
<pre><code>/**
 * Handler implementation for the echo server.
 */
@Sharable
public class EchoServerHandler extends ChannelInboundHandlerAdapter {

    @Override
    public void channelRead(ChannelHandlerContext ctx, Object msg) {
        ctx.write(msg);
    }

    @Override
    public void channelReadComplete(ChannelHandlerContext ctx) {
        ctx.flush();
    }

    @Override
    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) {
        // Close the connection when an exception is raised.
        cause.printStackTrace();
        ctx.close();
    }
}
</code></pre>
<p>é‚£ä¹ˆè¿™ä¸ª FlushConsolidationHandler æ˜¯æ€ä¹ˆä½¿ç”¨çš„å‘¢ï¼Ÿ</p>
<p>è¿™ä¸ª FlushConsolidationHandler ä¸»è¦æ˜¯åœ¨å¼‚æ­¥å†™ï¼ˆåœ¨ handler ä¸Šæ·»åŠ äº†çº¿ç¨‹æ± ï¼‰çš„æ—¶å€™ä½¿ç”¨çš„ï¼Œæ‹¦æˆªå¤šæ¬¡å¼‚æ­¥å†™å³é€šè¿‡å‰é¢ consolidateWhenNoReadInProgress æ¥æ§åˆ¶ï¼Œè€Œä¸”ä¸ºäº†é˜²æ­¢å¼‚æ­¥å†™æœªæ‰§è¡Œå¤Ÿè®¾å®šçš„ explicitFlushAfterFlushes ï¼Œä¼šæ·»åŠ ä¸€ä¸ª future æ¥è¿›è¡Œè°ƒç”¨æœ€åçš„ flush</p>
<p>å› ä¸º Netty çš„çº¿ç¨‹æ¨¡å‹æ˜¯ä¸€ä¸ª pipeline ç»‘å®šä¸€ä¸ªåŒä¸€ä¸ª eventLoopï¼Œæ‰€ä»¥ä¸ä¼šæœ‰å¹¶å‘æ‰§è¡Œçš„é—®é¢˜ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤šä¸ªè¯»äº‹ä»¶åœ¨ä¸€ä¸ª pipeline ä¸Šå‘ç”Ÿï¼Œåœ¨åŒä¸€æ¬¡è¯»äº‹ä»¶æœªç»“æŸä¹‹å‰ï¼ˆæœªè°ƒç”¨channelReadComplete ä¹‹å‰ï¼‰ éƒ½ä¼šæ˜¯ readInProgress trueï¼Œä¿è¯ flush çš„æ‰§è¡Œå¯ä»¥åœ¨è¯»äº‹ä»¶å¤„ç†å®Œåè¿›è¡Œï¼Œå¦‚æœè¯»äº‹ä»¶ç»“æŸäº†ï¼Œå°±å¯ä»¥ç›´æ¥ flush å‡ºå»ã€‚</p>
<p>ä½†æ˜¯åœ¨ä¸€ä¸ª pipeline ä¸Šçš„è¯»äº‹ä»¶å®Œæˆäº†ä¸å¸¦è¡¨çœŸæ­£çš„è¯»äº‹ä»¶å®Œæˆäº†ï¼Œå¦‚æœè¯»äº‹ä»¶æ˜¯åœ¨å¦èµ·ä¸€ä¸ªçº¿ç¨‹æ± çš„ä¸šåŠ¡çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œè™½ç„¶å½“å‰ pipelin ä¸Šçš„è¯»äº‹ä»¶å·²ç»è¿”å›äº†ï¼Œä½†æ˜¯å¯èƒ½è¿˜æ²¡æœ‰è°ƒç”¨ writeAndFlushã€‚<br>
consolidateWhenNoReadInProgress å‚æ•°çš„å­˜åœ¨å°±æ˜¯ä¸ºäº†åº”å¯¹è¿™ç§é—®é¢˜ã€‚</p>
<p>çœ‹ä¸‹å®ä¾‹çš„å¼‚æ­¥å†™æƒ…å†µï¼š</p>
<pre><code>UnorderedThreadPoolEventExecutor eventExecutors = new UnorderedThreadPoolEventExecutor(10);
try {
    serverBootstrap.group(boss, worker)
            .handler(new LoggingHandler(LogLevel.INFO))
            .childHandler(new ChannelInitializer&lt;NioSocketChannel&gt;() {
                protected void initChannel(NioSocketChannel ch) throws Exception {
                    ChannelPipeline pipeline = ch.pipeline();

                    pipeline.addLast(new ServerIdleCheckHandler());
                    pipeline.addLast(&quot;frameDecoder&quot;, new FrameDecoder());
                    pipeline.addLast(&quot;frameEncoder&quot;, new FrameEncoder());

                    pipeline.addLast(&quot;protocolEncoder&quot;, new ProtocolEncoder());
                    pipeline.addLast(&quot;protocolDecoder&quot;, new ProtocolDecoder());


                    pipeline.addLast(new LoggingHandler(LogLevel.INFO));
                    pipeline.addLast(eventExecutors, &quot;serviceHandler&quot;, serviceDispatchHandler);

                }
            });
    ChannelFuture sync = serverBootstrap.bind(8098).sync();
</code></pre>
<p>pipeline.addLast(eventExecutors, &quot;serviceHandler&quot;, serviceDispatchHandler); å…³é”®åœ¨è¿™è¡Œä»£ç </p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[# 2019]]></title>
        <id>https://jiangjinxinn.github.io/post/2019/</id>
        <link href="https://jiangjinxinn.github.io/post/2019/">
        </link>
        <updated>2020-01-25T07:33:16.000Z</updated>
        <content type="html"><![CDATA[<p>ç½‘ä¸Šçœ‹äº†äº›å¹´ç»ˆæ€»ç»“ï¼Œå¤§å¤šæ•°è¿˜æ˜¯æ‰“å¹¿å‘Šæ€§è´¨çš„ï¼Œè®²è¿°ä¸‹è‡ªå·±è¿™ä¸€å¹´å¹²äº†å•¥ï¼Œä½œä¸ºè®ºè¿°ä¸‹è‡ªå·±å¾ˆç‰›é€¼çš„è¯æ®ï¼Œç¡®å®ï¼Œä¸€çœ¼çœ‹ä¸‹æ¥æ„Ÿè§‰ä»–ä»¬è¾“å‡ºçœŸçš„ç‰›é€¼ï¼Œæš—æš—å’Œè‡ªå·±å¯¹æ¯”äº†ä¸‹ï¼Œå¿ƒé‡Œæ³›èµ·äº†å˜€å’•ï¼Œå’‹äººä¸äººä¹‹é—´å·®è·è¿™ä¹ˆå¤§å‘¢?</p>
<p>æˆ‘åœ¨ä»¥å‰çœ‹åˆ°è‡ªå·±å†™çš„ç¬”è®°å’Œæ—¥è®°æ—¶éƒ½ä¼šæƒ³è¦åˆ æ‰å®ƒä»¬ï¼Œå¿ƒé‡Œè¿˜è¦ç–‘é—®ä¸‹ï¼Œè¿™ä¸ªå‚»é€¼æ˜¯æˆ‘ï¼Ÿæ…¢æ…¢çš„ä½“ä¼šåˆ°æ—¶é—´é£é€ï¼Œç•™ä¸‹æ¥ä¸€äº›è®°å½•ä¹ŸæŒºæœ‰æ„æ€çš„ï¼Œå‚»é€¼çš„è‡ªå·±ä¹Ÿæ˜¯è‡ªå·±ï¼Œæ‰€ä»¥æœ‰äº†è¿™ç¯‡æ€»ç»“ã€‚</p>
<hr>
<p>æƒ³æ¥ä» 2018 å¹´ 6 æœˆæ¯•ä¸šè‡³ä»Šé©¬ä¸Šå°±è¦å·¥ä½œä¸¤å¹´äº†ï¼Œå’Œæ¯æ¬¡å›æƒ³ä»¥å‰çš„äº‹ä¸€æ ·ï¼Œéƒ½ä¼šæ„Ÿå¹æ—¶é—´è¿‡çš„ä¹‹å¿«ã€‚</p>
<p>æ„Ÿè§‰ç°åœ¨æŠ€æœ¯æ°´å¹³ç®—æ˜¯å…¥äº†ä¸ªé—¨å§ï¼Œä»åˆšå¼€å§‹æ¥å…¬å¸çš„æ—¶å€™ï¼Œidea ç”¨ä¸æ¥ï¼Œä¸Šç½‘æŸ¥æ•™ç¨‹åˆ°ç°åœ¨ä¸Šç½‘æŸ¥çœ‹é¢è¯•é¢˜ï¼Œå­¦ä¹ çš„è¿‡ç¨‹å°±æ˜¯è¿™ä¸ªæ ·å­å§ã€‚</p>
<p>æƒ³èµ·ç¬¬ä¸€æ¬¡çœ‹åˆ°ç»„é•¿ä»£ç é‡Œç”¨ BeanUtils çš„ copyProperties æ–¹æ³•ï¼Œç¬¬ä¸€æ¬¡çœ‹åˆ°åŒäº‹ç”¨ ApplicationContextAware æ—¶å€™çš„æƒŠè®¶ï¼Œçœ‹åˆ°åŒäº‹å°è£… react å†™ä¸ªç±»çš„æ—¶å€™ï¼Œçœ‹åˆ°å…¬å¸å†…éƒ¨ä½¿ç”¨çš„æ¡†æ¶æ˜¯ä¸»ç®¡å†™çš„æ—¶å€™ï¼Œæˆ‘å°å°çš„å†…å¿ƒéƒ½è¢«éœ‡æ’¼äº†ã€‚æœ‰ä¸€æ¬¡å¬åˆ°éš”å£ç»„çš„åŒäº‹è¯´åˆ†å¸ƒå¼é”çš„æ—¶å€™ï¼Œæ›´æ˜¯æµ‘èº«æŠ–æ“äº†ä¸€ä¸‹ï¼Œå¤ªç‰›é€¼äº†ï¼Œå¿ƒé‡Œä¸æ–­çš„å‘å‡ºæ„Ÿå¹ã€‚</p>
<p>ç„¶åå°±æ˜¯ç¨³æ­¥è¿›è¡Œä¸­çš„æ¬ç –äº‹ä¸šï¼Œè¢« react å‰ç«¯åŠæ‰“çš„è¿‡ç¨‹ï¼Œä» java åŸºç¡€å¼€å§‹æ¶è¡¥çŸ¥è¯†ã€‚</p>
<p>å°è±¡æ›´æ·±çš„å°±æ˜¯ä»Šå¹´å¹´ä¸­çš„æ—¶å€™ç»„é‡Œæ¥äº†ä¸ªå®ä¹ ç”Ÿï¼Œæƒ³ä¸‹åŒæœŸçš„è‡ªå·±åœ¨å¹²å•¥ï¼Œæ›´åŠ æ„Ÿè§‰è‡ªå·±å¤ªèœäº†ï¼Œè¿˜è¦åŠ æŠŠåŠ²ï¼Œä½†æ€»åˆæ„Ÿè§‰æœ‰ç‚¹å¥‡æ€ªï¼Œç®—æ¥ä¹Ÿ 25 å²äº†ï¼Œå’‹è¿˜è¦æ¯å¤©å­¦ä¹ ã€‚ã€‚</p>
<p>å¹´ä¸­ä»¥åæ¢äº†ä¸ªç»„ï¼Œå¼€å§‹å†™ç‚¹è¶…å‡ºæˆ‘æ°´å¹³çš„ä»£ç ï¼Œå†™éƒ½å†™ä¸æ¥ï¼Œåªèƒ½å»æŠ„ä»£ç ã€‚ã€‚çœ‹ nacos ä»£ç çš„æ—¶å€™ï¼Œè¢«ä»£ç é‡Œçš„å¿ƒè·³è¿æ¥æƒŠè‰³äº†ï¼Œé¡¿æ—¶æ„Ÿè§‰è‡ªå·±ä¹‹å‰ä¸çŸ¥é“åœ¨å¹²å•¥ï¼Œæ†¨æ†¨çš„ä¸€æ ·ã€‚å¥½åœ¨è™½ç„¶é¡¹ç›®è¶…æ—¶äº†ï¼Œç»„é•¿ä¹Ÿåªèƒ½èƒŒåå˜€å’•ä¸‹è¶…æ—¶äº†è¶…æ—¶äº†ï¼Œä¹Ÿä¸ä¼šè¯´å•¥ã€‚ã€‚ã€‚</p>
<p>æ…¢æ…¢å¿ƒé‡Œè§‰å¾—å…¬å¸ low çš„æ„Ÿè§‰è¶Šæ¥è¶Šå¼ºçƒˆï¼Œcode review éƒ½æ²¡æœ‰å•Šï¼Œè¿˜è¦è€æ˜¯å¼ºè°ƒä»£ç è§„èŒƒï¼ŒåŒäº‹ maven æ‰“ä¸ª jar åŒ…éƒ½è€æ˜¯ç¿»è½¦å‘æˆ‘ï¼Œä»€ä¹ˆæƒ…å†µå•Šã€‚å…¬å¸çš„æ–‡åŒ–ä¹Ÿè¶Šæ¥è¶Šç†Ÿæ‚‰ï¼Œç†Ÿæ‚‰åéšä¹‹è€Œæ¥çš„æ˜¯æœ‰ç‚¹å¤±æœ›ã€‚</p>
<p>è¿™ä¸€å¹´ç»©æ•ˆä¹Ÿä¸å¥½çœ‹ï¼Œå¿ƒæ€æ—¶å¸¸çˆ†ç‚¸ã€‚å¥½åœ¨ç°åœ¨èƒ½ç¨³çš„ä½äº†ã€‚</p>
<p>æˆ‘å¸Œæœ›è¿™é‡Œå°±ç®—åšæ˜¯å¯¹äº‹å®çš„æè¿°ï¼Œè€Œä¸æ˜¯æŠ±æ€¨ï¼Œæ¯•ç«ŸæŠ±æ€¨ä¸èƒ½è§£å†³é—®é¢˜ï¼Œä¹Ÿæ²¡äººä¼šå–œæ¬¢è´Ÿèƒ½é‡ã€‚ä½†è¿™é‡Œè¿˜æ˜¯ä¼šå¦‚å®çš„è®°å½•ä¸‹æˆ‘åé¢å¯¹å…¬å¸çš„çœ‹æ³•ï¼Œä¸åšä¿®é¥°ã€‚</p>
<hr>
<p>æ€»çš„æ¥è¯´ï¼Œæˆ‘è§‰å¾—æˆ‘è¿˜æ˜¯å¹¸è¿çš„ï¼Œåœ¨å…¬å¸çš„æ—¶å€™ä¸»è¦è¿˜æ˜¯åœ¨å­¦ä¹ ï¼Œæœ‰æ—¶å¹²äº›è¶…å‡ºè‡ªå·±æ°´å¹³çš„äº‹ã€‚æ›´éš¾èƒ½å¯è´µçš„æ˜¯å¿ƒæ€å¾—åˆ°äº†é”»ç‚¼ï¼Œè¿™ç§è´¢å¯Œè¿˜æ˜¯æ›´åŠ çè´µçš„ã€‚</p>
<p>æƒ³èµ·ä¸»ç®¡å¯¹æˆ‘è¯´ï¼Œæœ‰äº›ä¸œè¥¿åªæœ‰ä½ åœ¨ä¸€å®¶å…¬å¸å¾…çš„è¶³å¤Ÿä¹…æ‰ä¼šæ˜ç™½ã€‚æˆ‘è§‰å¾—æˆ‘æ˜ç™½äº†ä¸€äº›äº†ï¼Œä½†æˆ‘ä¸èƒ½ç¡®å®šæ˜¯ä¸æ˜¯ä»–æ‰€è¯´æ˜ç™½çš„ä¸œè¥¿ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Netty å¯¹ Reactor æ¨¡å¼å¸¸è§çš„ç–‘é—®]]></title>
        <id>https://jiangjinxinn.github.io/post/netty-dui-reactor-mo-shi-chang-jian-de-yi-wen/</id>
        <link href="https://jiangjinxinn.github.io/post/netty-dui-reactor-mo-shi-chang-jian-de-yi-wen/">
        </link>
        <updated>2019-12-15T12:34:10.000Z</updated>
        <content type="html"><![CDATA[<h2 id="netty-å¦‚ä½•æ”¯æŒä¸»ä»-reactor-æ¨¡å¼">Netty å¦‚ä½•æ”¯æŒä¸»ä» Reactor æ¨¡å¼</h2>
<p>ç®€å•æ¥è¯´å°±æ˜¯å°† ä¸¤ç§ channel æ³¨å†Œåˆ°ä¸¤ç§ EventLoopGroupä¸Šã€‚<br>
ä¸»è¦çš„é€»è¾‘åœ¨ å¼•å¯¼ç±» <code>ServerBootstrap</code> çš„ group() ä¸­é…ç½®äº† BossGroup å’Œ WorkGroupï¼Œä¼šåœ¨åé¢ register() å®Œæˆåˆå§‹åŒ–æ“ä½œã€‚</p>
<p>ServerBootstrap.group() æ–¹æ³•:</p>
<pre><code class="language-java">/**
 * Specify the {@link EventLoopGroup} which is used for the parent (acceptor) and the child (client).
 */
@Override
public ServerBootstrap group(EventLoopGroup group) {
    // â‘  éä¸»ä»çš„ Reactor æ¨¡å¼ï¼Œä¸€ä¸ª group å¹²ä¸¤ä¸ªæ´»
    return group(group, group);
}

/**
 * Set the {@link EventLoopGroup} for the parent (acceptor) and the child (client). These
 * {@link EventLoopGroup}'s are used to handle all the events and IO for {@link ServerChannel} and
 * {@link Channel}'s.
 */
// ä¸»ä»æ¨¡å¼çš„ group é…ç½®
public ServerBootstrap group(EventLoopGroup parentGroup, EventLoopGroup childGroup) {
    // â‘¡ è®¾ç½® parentGroup å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ boss group 
    super.group(parentGroup);
    if (childGroup == null) {
        throw new NullPointerException(&quot;childGroup&quot;);
    }
    if (this.childGroup != null) {
        throw new IllegalStateException(&quot;childGroup set already&quot;);
    }
    // â‘¢ è®¾ç½® childGroup å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ worker group
    this.childGroup = childGroup;
    return this;
}
</code></pre>
<p>å…ˆçœ‹ä¸‹æ­¥éª¤ â‘¡ è®¾ç½®äº† parentGroup åçš„åŠ¨ä½œã€‚<br>
åœ¨ <code>AbstractBootstrap#initAndRegister</code> åˆå§‹åŒ–ä¸­ä¼šå°†åé¢çš„ <code>ServerSocketChannel</code> æ³¨å†Œåˆ° parent gorup ä¸Šã€‚</p>
<pre><code class="language-java">final ChannelFuture initAndRegister() {
    Channel channel = null;
    try {
        channel = channelFactory.newChannel();
        // âœ…child groupåœ¨è¿™é‡Œåˆå§‹åŒ–
        init(channel);
    } catch (Throwable t) {
        if (channel != null) {
            // channel can be null if newChannel crashed (eg SocketException(&quot;too many open files&quot;))
            channel.unsafe().closeForcibly();
        }
        // as the Channel is not registered yet we need to force the usage of the GlobalEventExecutor
        return new DefaultChannelPromise(channel, GlobalEventExecutor.INSTANCE).setFailure(t);
    }
    // âœ… ServerSocketChannel åœ¨è¿™é‡Œæ³¨å†Œåˆ° parent group ä¸Š
    ChannelFuture regFuture = config().group().register(channel);
    if (regFuture.cause() != null) {
        if (channel.isRegistered()) {
            channel.close();
        } else {
            channel.unsafe().closeForcibly();
        }
    }
    return regFuture;
}
</code></pre>
<p>æ¥ç€æ¥çœ‹ä¸‹æ­¥éª¤ â‘¢ ä¸­è®¾ç½® childGroup åçš„æ“ä½œï¼Œå¦‚ä¸Šé¢è´´çš„ä»£ç å¯ä»¥çœ‹åˆ°åœ¨<code>AbstractBootstrap#initAndRegister</code> åŒæ—¶ä¹Ÿåˆå§‹åŒ–äº† childGroup çš„æ“ä½œ</p>
<pre><code class="language-java">void init(Channel channel) throws Exception {
    final Map&lt;ChannelOption&lt;?&gt;, Object&gt; options = options0();
    synchronized (options) {
        setChannelOptions(channel, options, logger);
    }

    final Map&lt;AttributeKey&lt;?&gt;, Object&gt; attrs = attrs0();
    synchronized (attrs) {
        for (Entry&lt;AttributeKey&lt;?&gt;, Object&gt; e: attrs.entrySet()) {
            @SuppressWarnings(&quot;unchecked&quot;)
            AttributeKey&lt;Object&gt; key = (AttributeKey&lt;Object&gt;) e.getKey();
            channel.attr(key).set(e.getValue());
        }
    }

    ChannelPipeline p = channel.pipeline();
    // â‘  childGroup æ¢äº†ä¸€ä¸ªåå­—
    final EventLoopGroup currentChildGroup = childGroup;
    final ChannelHandler currentChildHandler = childHandler;
    final Entry&lt;ChannelOption&lt;?&gt;, Object&gt;[] currentChildOptions;
    final Entry&lt;AttributeKey&lt;?&gt;, Object&gt;[] currentChildAttrs;
    synchronized (childOptions) {
        currentChildOptions = childOptions.entrySet().toArray(newOptionArray(childOptions.size()));
    }
    synchronized (childAttrs) {
        currentChildAttrs = childAttrs.entrySet().toArray(newAttrArray(childAttrs.size()));
    }

    p.addLast(new ChannelInitializer&lt;Channel&gt;() {
        @Override
        public void initChannel(final Channel ch) throws Exception {
            final ChannelPipeline pipeline = ch.pipeline();
            ChannelHandler handler = config.handler();
            if (handler != null) {
                pipeline.addLast(handler);
            }

            ch.eventLoop().execute(new Runnable() {
                @Override
                public void run() {
                    // â‘¡ ä¼ é€’ç»™ ServerBootstrapAcceptor
                    pipeline.addLast(new ServerBootstrapAcceptor(
                            ch, currentChildGroup, currentChildHandler, currentChildOptions, currentChildAttrs));
                }
            });
        }
    });
</code></pre>
<p>åœ¨ â‘¡ ä¸­å°† childGroup ä¼ é€’ç»™äº† <code>ServerBootstrapAcceptor</code>ï¼Œ ä»–å…¶å®æ˜¯ä¸ª <code>ChannelInboundHandlerAdapter</code>ï¼Œåœ¨ä»–çš„é‡å†™æ–¹æ³•<code>ServerBootstrap.ServerBootstrapAcceptor#channelRead</code>ä¸­å°†åç»­æ”¶åˆ°çš„ <code>SocketChannel</code> æ³¨å†Œåˆ° childGroup ä¸Š</p>
<pre><code class="language-java">@Override
@SuppressWarnings(&quot;unchecked&quot;)
public void channelRead(ChannelHandlerContext ctx, Object msg) {
    // â‘  è¿™ä¸ª msg å°±æ˜¯ SocketChannel
    final Channel child = (Channel) msg;

    child.pipeline().addLast(childHandler);

    setChannelOptions(child, childOptions, logger);

    for (Entry&lt;AttributeKey&lt;?&gt;, Object&gt; e: childAttrs) {
        child.attr((AttributeKey&lt;Object&gt;) e.getKey()).set(e.getValue());
    }

    try {
        // â‘¡ æ³¨å†Œåˆ° childGroup ä¸Š
        childGroup.register(child).addListener(new ChannelFutureListener() {
            @Override
            public void operationComplete(ChannelFuture future) throws Exception {
                if (!future.isSuccess()) {
                    forceClose(child, future.cause());
                }
            }
        });
    } catch (Throwable t) {
        forceClose(child, t);
    }
}
</code></pre>
<h2 id="ä¸ºä»€ä¹ˆè¯´-netty-çš„-main-reactor-å¤§å¤šå¹¶ä¸èƒ½ç”¨åˆ°ä¸€ä¸ªçº¿ç¨‹ç»„åªèƒ½çº¿ç¨‹ç»„é‡Œé¢çš„ä¸€ä¸ª">ä¸ºä»€ä¹ˆè¯´ Netty çš„ main reactor å¤§å¤šå¹¶ä¸èƒ½ç”¨åˆ°ä¸€ä¸ªçº¿ç¨‹ç»„ï¼Œåªèƒ½çº¿ç¨‹ç»„é‡Œé¢çš„ä¸€ä¸ª</h2>
<p>å› ä¸ºå¤§å¤šåªç»‘å®šä¸€ä¸ªåœ°å€ï¼Œæ‰€ä»¥å°±åªç”¨åˆ°çº¿ç¨‹ç»„é‡Œé¢çš„ä¸€ä¸ª<br>
<code>io.netty.bootstrap.AbstractBootstrap#doBind</code></p>
<h2 id="netty-ç»™-channel-åˆ†é…-nio-event-loop-çš„è§„åˆ™æ˜¯ä»€ä¹ˆ">Netty ç»™ Channel åˆ†é… NIO event loop çš„è§„åˆ™æ˜¯ä»€ä¹ˆ</h2>
<p>å¯¹äº NIO çš„ EventLoopGroup çš„å®ç°æ˜¯<code>MultithreadEventLoopGroup#register(io.netty.channel.Channel)</code></p>
<pre><code class="language-java">    @Override
    public ChannelFuture register(Channel channel) {
        // è¿™é‡Œçš„ next() æ˜¯ä¸ªé€‰æ‹©å™¨ï¼Œé€‰æ‹©ä¸€ä¸ª EventExecutor
        return next().register(channel);
    }
</code></pre>
<p>æœ€åæ˜¯åœ¨ <code>EventExecutorChooserFactory</code> çš„ç­–ç•¥æ¨¡å¼ä¸­é€‰æ‹©ä¸€ä¸ª <code>EventExecutor</code>ï¼Œ</p>
<pre><code class="language-java">/**
 * Factory that creates new {@link EventExecutorChooser}s.
 */
@UnstableApi
public interface EventExecutorChooserFactory {

    /**
     * Returns a new {@link EventExecutorChooser}.
     */
    EventExecutorChooser newChooser(EventExecutor[] executors);

    /**
     * Chooses the next {@link EventExecutor} to use.
     */
    @UnstableApi
    interface EventExecutorChooser {

        /**
         * Returns the new {@link EventExecutor} to use.
         */
        EventExecutor next();
    }
}
</code></pre>
<p>æœ‰ä¸¤ä¸ªå®ç°ç±»ä¸€ä¸ªæ˜¯<code>GenericEventExecutorChooser</code>ï¼Œå¦ä¸€ä¸ªæ˜¯<code>PowerOfTwoEventExecutorChooser</code>ï¼ŒåŒºåˆ«åœ¨äºé€‰æ‹©ä¸€ä¸‹ä¸ª<code>EventExecutor</code>æ—¶å€™ï¼Œå¦‚æœæ˜¯2çš„å¹‚æ¬¡ï¼Œå¯ä»¥ç›´æ¥æŒ‰ä¸ºä¸ <code>&amp;</code> æ“ä½œï¼Œé«˜æ•ˆä¸€ç‚¹ã€‚</p>
<h2 id="netty-å¦‚ä½•å®ç°å¤šè·¯å¤ç”¨å™¨è·¨å¹³å°çš„">Netty å¦‚ä½•å®ç°å¤šè·¯å¤ç”¨å™¨è·¨å¹³å°çš„</h2>
<p>Netty çš„ NIO Selector å°è£…åœ¨ <code>NioEventLoopGroup</code> ä¸­</p>
<pre><code class="language-java">public NioEventLoopGroup(int nThreads, Executor executor) {
    this(nThreads, executor, SelectorProvider.provider());
}
</code></pre>
<p>é€šè¿‡ <code>SelectorProvider.provider()</code> è·å–ç›¸åº”çš„Selectorã€‚</p>
<pre><code class="language-java">public static SelectorProvider provider() {
    synchronized (lock) {
        if (provider != null)
            return provider;
        return AccessController.doPrivileged(
            new PrivilegedAction&lt;SelectorProvider&gt;() {
                public SelectorProvider run() {
                        // â‘  ä»ç³»ç»Ÿå‚æ•°ä»è·å– nio selector çš„ spi å®ç°
                        if (loadProviderFromProperty())
                            return provider;
                        // â‘¡ é€šè¿‡ java spi åŠ è½½
                        if (loadProviderAsService())
                            return provider;
                        // â‘¢ jdk å®ç°
                        provider = sun.nio.ch.DefaultSelectorProvider.create();
                        return provider;
                    }
                });
    }
}   
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œnio çš„ selector è·å–æœ‰ä¸‰ç§é€”å¾„ï¼Œä¸€èˆ¬æœ€åå°±æ˜¯ sun çš„ jdk ä¸­çš„å®ç°ã€‚åœ¨ mac ä¸­æ˜¯ <code>KQueueSelectorProvider</code>ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Sublime éšæ‰‹è®°]]></title>
        <id>https://jiangjinxinn.github.io/post/sublime-sui-shou-ji/</id>
        <link href="https://jiangjinxinn.github.io/post/sublime-sui-shou-ji/">
        </link>
        <updated>2019-12-08T08:05:25.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ“ƒå®ç°ä¸€ä¸ªä¸ä¼šæç¤ºä¿å­˜çš„ Sublime éšæ‰‹è®°</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“ƒå®ç°ä¸€ä¸ªä¸ä¼šæç¤ºä¿å­˜çš„ Sublime éšæ‰‹è®°</p>
<!-- more -->
<figure data-type="image" tabindex="1"><img src="https://jiangjinxinn.github.io//post-images/1575792658471.jpg" alt="è®©äººå¿ƒçƒ¦çš„æç¤ºä¿å­˜" loading="lazy"></figure>
<p>çœ‹åˆ°ä¸Šé¢çš„æç¤ºæ¡†ï¼Œæˆ‘å¤´å¾ˆå¤§ã€‚å¹³æ—¶ç»å¸¸ ctrl n æ–°å»ºä¸€ä¸ªé¡µé¢ä¸´æ—¶å¤åˆ¶ä¸€äº›æ–‡æœ¬ï¼Œè¿›è¡Œå¯¹æ¯”æˆ–è€…æŸ¥çœ‹æˆ–è€…ä¸´æ—¶ä¿å­˜ä¸€ä¸‹ï¼Œä½†æ˜¯åœ¨å…³é—­æ–‡ä»¶çš„æ—¶å€™ä¼š Sublime æç¤ºä½ ä¿å­˜ï¼Œæ—¥ç§¯æœˆç´¯ä¸‹æ¥å°±æœ‰ç‚¹çƒ¦äº†ã€‚</p>
<p>æ‰€ä»¥é¡¹æ‰¾ä¸‹åŠæ³•æŠŠ Sublime æ”¹æˆè‰ç¨¿çº¸ï¼Œè®© ctrl n æ–°å»ºçš„é¡µé¢ç¼–è¾‘å…³é—­åä¸æç¤ºä¿å­˜ã€‚</p>
<hr>
<p>Sublime ç›¸å…³æ’ä»¶æœäº†ä¸€ä¼™å„¿æ²¡æœ‰å‘ç°ï¼Œåˆ° Stack Overflow ä¸Šæœäº†ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸€äº›æ–¹æ³•ã€‚</p>
<p><a href="https://stackoverflow.com/questions/24663013/sublime-text-prompt-to-save-file">sublimetext2 - Sublime Text Prompt to Save File - Stack Overflow</a></p>
<p><a href="https://forum.sublimetext.com/t/request-dont-prompt-to-save-empty-untitled-tabs/685">Request: Donâ€™t prompt to save empty â€œuntitledâ€ tabs - Ideas and Feature Requests - Sublime Forum</a></p>
<hr>
<p>æŒ‰ç…§ Stack Overflow ä¸Šçš„æ–¹æ³•ç”¨äº†ä¸‹ï¼Œå¾ˆå¥½ï¼Œå¾ˆæ»¡æ„ï¼Œæ–°åˆ›å»ºçš„æ–‡æ¡£ä¼šè¢«æ ‡è®°ä¸ºè‰ç¨¿æ–‡ä»¶ï¼Œä¿®æ”¹åä¸ä¼šæç¤ºä¿å­˜ã€‚ä¿®æ”¹å·²å­˜åœ¨çš„æ–‡ä»¶ä»ç„¶è¿˜æœ‰æç¤ºä¿å­˜ã€‚</p>
<p>Stack Overflow ä¸Šçš„ä»£ç æœ‰ä¸ªåœ°æ–¹è¦æ”¹ä¸‹</p>
<pre><code class="language-python">class SetNewScratchBuffer(sublime_plugin.EventListener):
    def on_new(self, view):
        view.set_scratch(True)

    def on__save(self, view):
        view.set_scratch(False)
</code></pre>
<p><code>on_save</code> éœ€è¦æ”¹æˆ <code>on_pre_save</code>ã€‚åœ¨ <a href="http://www.sublimetext.com/docs/3/api_reference.html#sublime_plugin.EventListener">Sublime API Reference</a> æ²¡æœ‰çœ‹åˆ° <code>on_save</code> çš„ä¿¡æ¯ã€‚</p>
<p>è¿˜æœ‰ä¸ª bugï¼Œè¿›ç¨‹é€€å‡ºå¯åŠ¨ Sublime åœ¨é»˜è®¤çš„ untitled æ–‡ä»¶ä¸Šä¸ä¼šç”Ÿæ•ˆï¼Œä½†æ˜¯ä¸é€€å‡ºè¿›ç¨‹çš„è¯ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œä¸çŸ¥é“æ˜¯å¦æ˜¯ Sublime çš„ bugã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Stream ç”Ÿæˆå‹¾è‚¡æ•°]]></title>
        <id>https://jiangjinxinn.github.io/post/stream-sheng-cheng-gou-gu-shu/</id>
        <link href="https://jiangjinxinn.github.io/post/stream-sheng-cheng-gou-gu-shu/">
        </link>
        <updated>2019-11-06T14:01:33.000Z</updated>
        <content type="html"><![CDATA[<p>çªç„¶æƒ³èµ·å»å¹´çœ‹çš„ã€Šjava8 å®æˆ˜ã€‹ä¸Šçš„ç”¨ Stream ç”Ÿæˆå‹¾è‚¡æ•°çš„ä¾‹å­ã€‚è¿™é‡Œè¯•ä¸€ä¸‹ã€‚<br>
å…³é”®åœ¨äº flatMap å’Œç”Ÿæˆå…ˆè¿›è¡Œè¿‡æ»¤å†ç”Ÿæˆæ•°ç»„ï¼Œè™½ç„¶è®¡ç®—äº†ä¸¤æ¬¡å¼€æ–¹ï¼Œä½†æ˜¯ç”Ÿæˆæ•°ç»„çš„å¼€é”€æ›´å¤§ã€‚</p>
<pre><code class="language-java">import java.util.stream.IntStream;
import java.util.stream.Stream;

class Scratch {
    public static void main(String[] args) {
        long start = System.currentTimeMillis();
        Stream&lt;int[]&gt; pythagoreanTriple = IntStream.rangeClosed(1, 100).boxed()
                .flatMap(a -&gt; IntStream.rangeClosed(a, 100)
                        .filter(b -&gt; Math.sqrt(a * a + b * b) % 1 == 0)
                        .mapToObj(b -&gt; new int[]{a, b, (int) Math.sqrt(a * a + b * b)}));

        pythagoreanTriple.limit(10).forEach(t -&gt; System.out.println(t[0] + &quot; &quot; + t[1] + &quot; &quot; + t[2]));
        long end = System.currentTimeMillis();
        System.out.println(&quot;total time: &quot; + (end - start) + &quot;\n&quot;);


        long start2 = System.currentTimeMillis();
        Stream&lt;int[]&gt; pythagoreanTriple2 = IntStream.rangeClosed(1, 100).boxed()
                .flatMap(a -&gt; IntStream.rangeClosed(a, 100)
                        .mapToObj(b -&gt; new int[]{a, b, (int) Math.sqrt(a * a + b * b)}))
                        .filter(t -&gt; Math.sqrt(t[2]) % 1 == 0);

        pythagoreanTriple2.limit(10).forEach(t -&gt; System.out.println(t[0] + &quot; &quot; + t[1] + &quot; &quot; + t[2]));
        long end2 = System.currentTimeMillis();
        System.out.println(&quot;total time 2: &quot; + (end2 - start2) + &quot;\n&quot;);
    }
}
</code></pre>
<p>è¿è¡Œçš„ç»“æœ</p>
<pre><code>3 4 5
5 12 13
6 8 10
7 24 25
8 15 17
9 12 15
9 40 41
10 24 26
11 60 61
12 16 20
total time: 91

1 1 1
1 4 4
1 9 9
1 16 16
1 25 25
1 36 36
1 49 49
1 64 64
1 81 81
1 100 100
total time 2: 3


Process finished with exit code 0
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[leetcode-cn.com ui ä¿®æ”¹]]></title>
        <id>https://jiangjinxinn.github.io/post/leetcode-cncom-ui-xiu-gai/</id>
        <link href="https://jiangjinxinn.github.io/post/leetcode-cncom-ui-xiu-gai/">
        </link>
        <updated>2019-11-02T14:51:04.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ç¼˜èµ·">ç¼˜èµ·</h2>
<p>ç”±äºçœ‹åˆ° leetcode ä¸­å›½ç‰ˆæ›´æ–°äº†æ–°çš„ä»£ç ç¼–è¾‘å™¨å’Œé•¿ä¹…ä»¥æ¥åœ¨ leetcode ç¾å›½ç‰ˆç½‘ç»œæœ‰æ—¶ä¸é¡ºç•…ï¼Œå†³å®šè¿åˆ°ä¸­å›½ç‰ˆä¸Šæ¥ã€‚</p>
<p>è¿™æ—¶å€™å°±ç¢°åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¸­å›½ç‰ˆæ”¹äº†åšé¢˜åŒºçš„ uiï¼Œçœ‹ç€æ„Ÿè§‰éå¸¸çš„éš¾å—ï¼Œä¸ä¹ æƒ¯ã€‚</p>
<p>ç¾å›½ç‰ˆçš„åšé¢˜åŒºçš„å¤´éƒ¨æ ‡é¢˜åŒºç­‰æµ‘ç„¶ä¸€ä½“ååˆ†è‡ªç„¶<br>
<img src="https://jiangjinxinn.github.io//post-images/1572706485835.png" alt="" loading="lazy"></p>
<p>ä¸­å›½ç‰ˆæ ‡é¢˜åŒºå•ç‹¬ä¸Šç§»å‡ºæ¥ï¼Œæœ€é‡è¦çš„æ˜¯è¾¹æ¡†ä¸åº•ä¸‹éƒ¨åˆ†åŠ äº†é˜´å½±ï¼Œæ„Ÿè§‰éå¸¸çš„å¥‡æ€ªã€‚<br>
<img src="https://jiangjinxinn.github.io//post-images/1572706501580.png" alt="" loading="lazy"></p>
<h2 id="åŠ¨æ‰‹æ”¹ä¸€ä¸‹">åŠ¨æ‰‹æ”¹ä¸€ä¸‹</h2>
<p>å®‰è£… chrome çš„æ‰©å±•æ’ä»¶ <a href="https://chrome.google.com/webstore/detail/stylus/clngdbkpkpeebahjckkjfobafhncgmne?hl=zh-CN">Stylus</a></p>
<blockquote>
<p>Stylus æ˜¯ä¸€ä¸ªè°ƒæ•´ç½‘é¡µå¤–è§‚çš„ç”¨æˆ·æ ·å¼ç®¡ç†å™¨ã€‚å®ƒå¯è®©æ‚¨è½»æ¾åœ°ä¸ºè®¸å¤šçƒ­é—¨ç½‘ç«™ç½‘ç«™å®‰è£…ä¸»é¢˜å’Œçš®è‚¤ã€‚</p>
</blockquote>
<p>ç‚¹å‡»ç¼–å†™æ ·å¼<br>
<img src="https://jiangjinxinn.github.io//post-images/1572707096588.png" alt="" loading="lazy"></p>
<p>æ·»åŠ  css æ ·å¼ä¿®æ”¹ä¸‹</p>
<pre><code class="language-css">[class*=&quot;HeaderCn&quot;] {
    box-shadow: none
}

[class*=&quot;ant-dropdown-menu-item&quot;] a[href]::after {
    display: none
}

[class*=&quot;NavbarListItem&quot;] a[href]::after {
    display: none
}

[class*=&quot;StyledBanner&quot;] {
    display: none
}
</code></pre>
<h2 id="æœ€ç»ˆæ•ˆæœ">æœ€ç»ˆæ•ˆæœ</h2>
<p>é˜´å½±å»æ‰åçœ‹èµ·æ¥å°±èˆ’æœå¤šã€‚é¡ºå¸¦å¯¼èˆªæ ä¸Šèœå•æ–‡å­—åé¢çš„ newã€hot ä¹Ÿä¸€èµ·å¤„ç†æ‰äº†ã€‚<br>
<img src="https://jiangjinxinn.github.io//post-images/1572708099346.png" alt="" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[é¢è¯•ï¼ˆ2019 å¹´ 10 æœˆï¼‰]]></title>
        <id>https://jiangjinxinn.github.io/post/mian-shi-2019-nian-10-yue/</id>
        <link href="https://jiangjinxinn.github.io/post/mian-shi-2019-nian-10-yue/">
        </link>
        <updated>2019-11-01T20:07:54.000Z</updated>
        <content type="html"><![CDATA[<h2 id="we-å…¬å¸">we å…¬å¸</h2>
<p>10 æœˆ 18æ—¥</p>
<p>ç°åœºé¢ï¼ˆåˆè®¡hr é¢ 2 å°æ—¶ 15 åˆ†ï¼‰</p>
<p>é¢è¯•å®˜ 1:</p>
<ol>
<li>çœ‹è¿‡å“ªäº›æºç ï¼Ÿ</li>
<li>spring bean ç”Ÿå‘½å‘¨æœŸ</li>
<li>å‡è®¾ä¸€ä¸ªç±» A å¦‚ä¸‹ï¼ŒbeanFactory ä¸­æœ‰ä¸¤ä¸ªç±»å‹çš„ Carï¼ŒbeanId ä¸º carAï¼ŒcarBï¼Œä¸‹é¢ç±»ä¸­ä¸­ Carèƒ½å¦æ³¨å…¥æˆåŠŸï¼Œ å¦‚ä½•è®© car çš„æ³¨å…¥åŠ¨æ€åŒ–</li>
</ol>
<pre><code>class A {
    @Resource
    private Car someCar;
    
    public someMethod(Car someCar) {
        // sout
    }
}
</code></pre>
<ul>
<li>å¦‚ä½•å®ç°ä¸€ä¸ª LRU ç®—æ³•</li>
<li>å†™ä¸‹é€’å½’ n çš„é˜¶å±‚</li>
<li>java ä¸­ juc åŒ…ä¸‹å“ªäº›é”æ˜¯ cas æ“ä½œï¼Ÿ</li>
<li>synchronized å’Œå¯é‡å…¥é”ï¼ŒJMMã€volatile</li>
<li>mysql æ ¹æ®æ€§åˆ«æŸ¥è¯¢ä¸åŒçš„ç”¨æˆ·æ€ä¹ˆåŠ ç´¢å¼•</li>
<li>mysql ç´¢å¼•</li>
<li>æµè§ˆå™¨åœ°å€æ è¾“å…¥ç½‘å€åçš„è¿‡ç¨‹</li>
<li>èŠäº†ä¸‹è®¾è®¡æ¨¡å¼</li>
<li>èŠäº†ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡</li>
<li>äº§å“ç»ç†æ¯”è¾ƒçƒ‚æ€ä¹ˆåŠ</li>
</ul>
<p>é¢è¯•å®˜ 2ï¼š</p>
<ul>
<li>react çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>webpack ç”¨è¿‡æ²¡</li>
<li>zookeeper ä¸€è‡´æ€§åŸç†äº†ï¼Œzookeeper æ ¸å¿ƒåŸç†æ˜¯å•¥</li>
<li>æœ‰æ²¡æœ‰é«˜å¹¶å‘ç»éªŒ</li>
<li>å®ç°ä»¥ä¸‹ä»£ç ï¼Œæ¨¡ä»¿ConcurrentHashMap çš„computeIfAbsentï¼Œä½†æ˜¯è¦æ±‚åŒæ ·çš„ key å’Œ mappingFunctionåŒæ—¶è¯·æ±‚çš„æ—¶å€™åªè®¡ç®—ä¸€æ¬¡ï¼Œé˜»å¡å…¶ä»–çº¿ç¨‹</li>
</ul>
<pre><code>public class ConcurrentHashMap {
    public V computeIfAbsent(K key,
            Function&lt;? super K, ? extends V&gt; mappingFunction) {
        /**
        /* è¦æ±‚ mappingFunction åªè®¡ç®—ä¸€æ¬¡ï¼Œå³åŒæ · keyã€mappingFunction 
        /* è°ƒç”¨çš„æ—¶å€™åªè®¡ç®—ä¸€æ¬¡,mappingFunction,é˜»å¡å¦ä¸€ä¸ªçº¿ç¨‹çš„è°ƒç”¨
        */
    }
}
</code></pre>
<h2 id="yz-å…¬å¸">yz å…¬å¸ï¼š</h2>
<p>ç”µè¯é¢ï¼ˆçº¦ 30 åˆ†é’Ÿï¼‰<br>
2. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åˆ†åº“åˆ†è¡¨<br>
3. è§£é‡Šä¸‹ä¸€æ¡ sql åœ¨åˆ†åº“åˆ†è¡¨ä¸‹æ˜¯æ€ä¹ˆæŸ¥è¯¢çš„<br>
4. é¡¹ç›®ä¸­ mq ç”¨æ¥å¹²å˜›çš„<br>
5. mq æ¶ˆæ¯å‘é€å¤±è´¥æ€ä¹ˆå¤„ç†<br>
6. inodb ç´¢å¼•<br>
7. éš”ç¦»çº§åˆ«<br>
8. mvccï¼Œéš”ç¦»çº§åˆ«æ€ä¹ˆå®ç°çš„<br>
9. è®²ä¸‹ä¸€è‡´æ€§è§†å›¾<br>
10. è¡Œé”</p>
<h2 id="dd-å…¬å¸">dd å…¬å¸</h2>
<p>ç”µè¯é¢ï¼ˆçº¦ 1 å°æ—¶ 10 åˆ†ï¼‰</p>
<ol>
<li>ç”¨æˆ·æ‰“åˆ†ç®—æ³• bm5ï¼ˆå¬ä¸æ¸…å«å•¥äº†ï¼‰äº†è§£å¦</li>
<li>å¹¶å‘é‡æœ‰å¤šå°‘ï¼Œè¯·æ±‚é‡å¤šå°‘</li>
<li>å¾®æœåŠ¡ç”¨çš„ä»€ä¹ˆæ¡†æ¶</li>
<li>ç®€å†ä¸Šçš„æ ¡éªŒæ¡†æ¶å¹²å˜›çš„ï¼Œæœ‰ä»€ä¹ˆéš¾ç‚¹</li>
<li>ä»‹ç»ä¸‹ dubbo
<ol>
<li>dubbo ä¸»è¦åˆ†å±‚</li>
<li>æ³¨å†Œä¸­å¿ƒæŒ‚äº†è¿˜èƒ½è°ƒç”¨å—</li>
<li>è®²è¿°ä¸‹æœåŠ¡ç«¯å‘èµ·ä¸€æ¬¡è¯·æ±‚çš„è¿‡ç¨‹</li>
<li>åºåˆ—åŒ–æœºåˆ¶æœ‰å“ªäº›</li>
<li>å®ç° dubbo æ‰©å±•æœºåˆ¶ spi è¦æ·»åŠ å“ªäº›ç±»</li>
<li>åºåˆ—åŒ–å®ç°äº†è§£å—ï¼Œä¸ºä»€ä¹ˆé€‰ç”¨ hessian</li>
<li>è´Ÿè½½å‡è¡¡æœºåˆ¶æœ‰å“ªäº›</li>
<li>è®©ä½ æ¥è®¾è®¡ä¸€ä¸ª rpc æ¡†æ¶ï¼Œå¦‚ä½•è®¾è®¡</li>
</ol>
</li>
<li>mysql ç´¢å¼•ã€mvcc</li>
<li>å¹¶å‘ç›¸å…³</li>
<li>
<ol>
<li>volatile è¯­ä¹‰ï¼Œä½¿ç”¨åœºæ™¯ã€JMM
<ol>
<li>sychronized åŸç†ã€è®²è¿°ä¸‹é”ä¼˜åŒ–ã€é”è†¨èƒ€</li>
<li>å¯é‡å…¥é”å’Œè¯»å†™é”</li>
<li>çº¿ç¨‹æ± åŒ…ä¸‹ä¸»è¦æœ‰å“ªäº›ç±»ï¼Œä¸»è¦æ˜¯æ€ä¹ˆè®¾è®¡çš„</li>
<li>çº¿ç¨‹æ± ä¸­çš„é˜»å¡é˜Ÿåˆ—æœ‰å“ªäº›</li>
<li>ConcurrentHashMap</li>
</ol>
</li>
</ol>
</li>
<li>æœ‰æ²¡æœ‰ç¢°åˆ°è¿‡ oomã€sql ä¼˜åŒ–ç»éªŒ</li>
<li>redis
<ol>
<li>äº‹åŠ¡äº†è§£å—</li>
<li>ç®¡é“æ“ä½œäº†è§£å—</li>
<li>æœ‰å“ªäº›æ•°æ®ç»“æ„</li>
<li>é›†ç¾¤</li>
</ol>
</li>
<li>Spring Boot</li>
<li>
<ol>
<li>è®²è¿°ä¸‹ä½ çš„ç†è§£ï¼Œå’Œ Spring æœ‰å“ªäº›åŒºåˆ«
<ol>
<li>æ¡ä»¶è£…é…æ€ä¹ˆå®ç°çš„</li>
<li>å¦‚ä½•å®ç°ä¸€ä¸ª SpringBoot Starter</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="mk-å…¬å¸">mk å…¬å¸</h2>
<p>ç°åœºé¢ï¼ˆåˆè®¡hr é¢çº¦ 2 å°æ—¶ 30 åˆ†ï¼‰</p>
<p>é¢è¯•å®˜ 1ï¼š</p>
<ul>
<li>Hashmapã€ConcurrentHashMap
<ul>
<li>HashMap å¹¶å‘ç¯å¢ƒä¸‹æœ‰ä»€ä¹ˆé—®é¢˜</li>
<li>ä¸ºä»€ä¹ˆä½¿ç”¨çº¢é»‘æ ‘</li>
<li>çº¢é»‘æ ‘ crud å“ªä¸ªæ“ä½œæœ€å¿«</li>
</ul>
</li>
<li>JVM å†…å­˜åŒº
<ul>
<li>ä»‹ç»ä¸‹å¸¸é‡æ± </li>
<li>å †ä¸­å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸º gc-roots</li>
<li>è®²è¿°ä¸‹ç±»åŠ è½½è¿‡ç¨‹</li>
</ul>
</li>
<li>Sychronized
<ul>
<li>è®²ä¸€ä¸‹é”è†¨èƒ€å¦‚ä½•å®ç°</li>
<li>JMM å†…å­˜æ¨¡å‹</li>
</ul>
</li>
<li>çº¿ç¨‹æ± å‚æ•°
<ul>
<li>æ ¸å¿ƒçº¿ç¨‹æ•°ä¸æœ€å¤§çº¿ç¨‹æ•°çš„åŒºåˆ«</li>
<li>å·¥ä½œé˜Ÿåˆ—æœ‰å“ªå‡ ç§</li>
<li>æ ¸å¿ƒçº¿ç¨‹æ•°æ»¡äº†ä»¥åæ·»åŠ æ–°ä»»åŠ¡å¦‚ä½•å¤„ç†çš„</li>
<li>ä»»åŠ¡æ‹’ç»ç­–ç•¥æœ‰å“ªäº›</li>
</ul>
</li>
<li>BeanFactory ä¸ FactoryBean çš„åŒºåˆ«</li>
<li>è®²ä¸€ä¸‹ mysql ç´¢å¼•
<ul>
<li>è”åˆç´¢å¼•ï¼ˆA,B,C) æŸ¥è¯¢ï¼ˆB,C) èƒ½å¦ä½¿ç”¨ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li>
<li>è®²ä¸€ä¸‹mysql ç´¢å¼•ä½¿ç”¨éœ€è¦æ³¨æ„çš„åœ°æ–¹</li>
<li>ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„</li>
<li>ä¸ºä»€ä¹ˆä½¿ç”¨ b+æ ‘</li>
</ul>
</li>
<li>Dubbo äº†è§£å—
<ul>
<li>è´Ÿè½½å‡è¡¡æœ‰å“ªäº›ç­–ç•¥</li>
<li>ä¸€è‡´æ€§ hash åŸç†</li>
</ul>
</li>
<li>ThreadLocal ä½¿ç”¨è¿‡å—
<ul>
<li>ThreadLocal æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li>
<li>æ€ä¹ˆå®ç°çš„</li>
</ul>
</li>
<li>Redis
<ul>
<li>String æ•°æ®ç»“æ„æ˜¯å¦‚ä½•å®ç°çš„</li>
<li>è®²ä¸‹è·³è¡¨</li>
<li>å¤‡ä»½ç­–ç•¥</li>
<li>ä¸»ä»åŒæ­¥</li>
</ul>
</li>
</ul>
<p>é¢è¯•å®˜ 2ï¼š</p>
<ul>
<li>è®¾è®¡æ¨¡å¼
<ul>
<li>è®¾è®¡æ¨¡å¼æœ‰å“ªäº›åŸåˆ™</li>
<li>ç­–ç•¥æ¨¡å¼</li>
<li>æ¨¡æ¿æ–¹æ³•</li>
</ul>
</li>
<li>æ•°æ®ç»“æ„
<ul>
<li>éå†å›¾æœ‰å‡ ç§æ–¹å¼</li>
</ul>
</li>
<li>æœ‰æ²¡æœ‰ oom è¿‡</li>
<li>è€å¹´ä»£çš„å¯¹è±¡çš„å¹´é¾„éƒ½ä¸å¤§æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿå¦‚ä½•è°ƒä¼˜ï¼Ÿ</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Nacos æœåŠ¡åˆ é™¤å¤±è´¥çš„é—®é¢˜]]></title>
        <id>https://jiangjinxinn.github.io/post/nacos-fu-wu-shan-chu-shi-bai-de-wen-ti/</id>
        <link href="https://jiangjinxinn.github.io/post/nacos-fu-wu-shan-chu-shi-bai-de-wen-ti/">
        </link>
        <updated>2019-10-14T06:12:22.000Z</updated>
        <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨ Nacos ä½œä¸ºæœåŠ¡ç›‘æ§çš„åŠŸèƒ½çš„æ—¶å€™å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼š<br>
åˆ é™¤æœåŠ¡æç¤ºå¤±è´¥ï¼š<br>
<img src="https://jiangjinxinn.github.io//post-images/1571033820491.png" alt="" loading="lazy"></p>
<p>æç¤ºæ˜¯å¯¹åº”çš„æœåŠ¡ä¸å­˜åœ¨<br>
ä½†æ˜¯å®é™…ä¸Š nacos çš„åå°ç®¡ç†é¡µé¢ä¸Šæ˜¯å­˜åœ¨çš„ï¼Œå¹¶ä¸”æˆ‘çš„åå°é¡µé¢ä¸Šè¿˜å‡ºç°äº†ä¸¤ä¸ªåŒåçš„æœåŠ¡ï¼Œå…¶ä¸­ä¸€ä¸ªå¯ä»¥åˆ é™¤æˆåŠŸï¼Œå¦ä¸€ä¸ªä¼šæŠ¥æœåŠ¡ä¸å­˜åœ¨</p>
<p>å›å¿†äº†ä¸‹æˆ‘ä¹‹å‰çš„æ“ä½œï¼Œå…¶ä¸­ä¸€æ¬¡åœ¨æ³¨å†ŒæœåŠ¡å®ä¾‹çš„æ—¶å€™ï¼Œåœ¨æœåŠ¡ååé¢å¸¦ä¸Šäº† <code>@@</code>ï¼ŒåŠ è¿™ä¸ªåŸå…ˆæ˜¯ä¸ºäº†åšæœåŠ¡åŒºåˆ†ç”¨çš„ï¼Œç”¨<code>@@</code> å­—ç¬¦æ˜¯å› ä¸ºæˆ‘åœ¨ nacos çš„æºç ä¸­çœ‹åˆ°ä»–ä»¬æ˜¯ç”¨ group + <code>@@</code> + serviceName ä½œä¸º service çš„æ ‡è¯†çš„ï¼Œæƒ³æ¨¡ä»¿ä¸€æ³¢ï¼Œè´´è¿‘é£æ ¼ã€‚ã€‚ã€‚</p>
<p>ç›´æ¥åˆ°ä»£ç ä¸­æ‰¾åŸå› ï¼Œå…ˆæ‰¾åˆ°æŠ›å‡ºå¼‚å¸¸çš„åœ°æ–¹<br>
<code>com.alibaba.nacos.naming.core.ServiceManager#easyRemoveService</code></p>
<pre><code>    public void easyRemoveService(String namespaceId, String serviceName) throws Exception {

        Service service = getService(namespaceId, serviceName);
        if (service == null) {
            // è¿™é‡ŒæŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±æ˜¯ï¼Œservice ä¸ºæ²¡æœ‰æŸ¥è¯¢åˆ°
            throw new IllegalArgumentException(&quot;specified service not exist, serviceName : &quot; + serviceName);
        }

        if (!service.allIPs().isEmpty()) {
            throw new IllegalArgumentException(&quot;specified service has instances, serviceName : &quot; + serviceName);
        }

        consistencyService.remove(KeyBuilder.buildServiceMetaKey(namespaceId, serviceName));
    }
</code></pre>
<p>è·å– service çš„æ–¹æ³•åœ¨è¿™ä¸ªæ¥å£ä¸­<br>
<code>com.alibaba.nacos.naming.core.ServiceManager#getService</code></p>
<pre><code>    public Service getService(String namespaceId, String serviceName) {
        if (serviceMap.get(namespaceId) == null) {
            return null;
        }
        // è¿™é‡Œç›´æ¥ä» map ä¸­æŸ¥è¯¢ key ä¸ºserviceName çš„ Service
        return chooseServiceMap(namespaceId).get(serviceName);
    }
</code></pre>
<p>å¯ä»¥çœ‹åˆ°å°±æ˜¯åˆ°å­˜å‚¨äº† service çš„ concurrentHashMap ä¸­æŸ¥è¯¢ service</p>
<pre><code>    /**
     * Map&lt;namespace, Map&lt;group::serviceName, Service&gt;&gt;
     */
    private Map&lt;String, Map&lt;String, Service&gt;&gt; serviceMap = new ConcurrentHashMap&lt;&gt;();
</code></pre>
<p>è¿™é‡Œæ²¡æœ‰æŸ¥è¯¢åˆ°ï¼Œè¯´æ˜ serviceMap æ²¡æœ‰å­˜å‚¨äº†ç›¸åº”çš„é”®å€¼å¯¹æ•°æ®</p>
<p>serviceMap ä¸­æ²¡æœ‰å­˜å–æ•°æ®ï¼Œé‚£æ§åˆ¶åå°ä¸Šæ˜¾ç¤ºçš„æœåŠ¡å®ä¾‹æ•°æ®æ˜¯å“ªé‡Œæ¥çš„å‘¢ï¼Ÿä» controller çš„æ¥å£ä¸ŠæŸ¥çœ‹ä¸‹<br>
<code>com.alibaba.nacos.naming.controllers.CatalogController#listDetail</code></p>
<pre><code>  @RequestMapping(value = &quot;/services&quot;, method = RequestMethod.GET)
    public Object listDetail(HttpServletRequest request) {

        boolean withInstances = Boolean.parseBoolean(WebUtils.optional(request, &quot;withInstances&quot;, &quot;true&quot;));

        if (withInstances) {
            String namespaceId = WebUtils.optional(request, CommonParams.NAMESPACE_ID,
                Constants.DEFAULT_NAMESPACE_ID);
            List&lt;ServiceDetailInfo&gt; serviceDetailInfoList = new ArrayList&lt;&gt;();
            int pageNo = Integer.parseInt(WebUtils.required(request, &quot;pageNo&quot;));
            int pageSize = Integer.parseInt(WebUtils.required(request, &quot;pageSize&quot;));
            String keyword = WebUtils.optional(request, &quot;keyword&quot;, StringUtils.EMPTY);

            List&lt;Service&gt; serviceList = new ArrayList&lt;&gt;(8);
            // æ§åˆ¶å°ä¸Šè¿”å›å¸¦æ•°æ®æ¥è‡ªè¿™é‡Œï¼ŒserviceList ä¼ å…¥serviceManager.getPagedService æ–¹æ³•ä¸­è¢«å¡«å……äº†æ•°æ®
            // åå°ç•Œé¢ä¸Šæœ‰æ•°æ®ï¼Œè¯´æ˜è¿™é‡Œè¿”å›äº†æ•°æ®ï¼Œç»§ç»­å¾€ä¸‹çœ‹ä¸‹
            serviceManager.getPagedService(namespaceId, pageNo, pageSize, keyword, StringUtils.EMPTY, serviceList, false);

            for (Service service : serviceList) {
                ServiceDetailInfo serviceDetailInfo = new ServiceDetailInfo();
                // è¿™é‡Œå°† Service çš„åå­—è¿›è¡Œäº†è½¬åŒ–ï¼Œå°±æ˜¯ä¹‹å‰è¯´çš„ï¼ŒserviceName æ˜¯ group + serviceNameï¼Œè¿™é‡Œè¦æŠŠ group å»æ‰
                serviceDetailInfo.setServiceName(NamingUtils.getServiceName(service.getName()));
                serviceDetailInfo.setGroupName(NamingUtils.getGroupName(service.getName()));
                serviceDetailInfo.setMetadata(service.getMetadata());

                Map&lt;String, ClusterInfo&gt; clusterInfoMap = getStringClusterInfoMap(service);
                serviceDetailInfo.setClusterMap(clusterInfoMap);

                serviceDetailInfoList.add(serviceDetailInfo);
            }

            return serviceDetailInfoList;
        } else {
            return serviceList(request);
        }
    }
</code></pre>
<p>è¿›å…¥åˆ° <code>NamingUtils</code> ä¸­çœ‹ä¸‹å…·ä½“æ˜¯å¦‚ä½•æŠŠ group å»æ‰ï¼Œè¿›è¡Œ name è½¬åŒ–çš„ã€‚</p>
<pre><code>public class NamingUtils {

    public static String getGroupedName(String serviceName, String groupName) {
        return groupName + Constants.SERVICE_INFO_SPLITER + serviceName;
    }

    public static String getServiceName(String serviceNameWithGroup) {
        if (!serviceNameWithGroup.contains(Constants.SERVICE_INFO_SPLITER)) {
            return serviceNameWithGroup;
        }
        // public static final String SERVICE_INFO_SPLITER = &quot;@@&quot;;
        // è¿™é‡Œæ˜¯é€šè¿‡ç›´æ¥å°†å­—ç¬¦ä¸²æŒ‰ &quot;@@&quot; åˆ†å‰²ï¼Œè¿”å›æ•°æ®ï¼Œæ‰€ä»¥å¦‚æœæœåŠ¡çš„åå­—å¸¦æœ‰`@@`ï¼Œ`@@` ä¼šè¢«å»æ‰
        return serviceNameWithGroup.split(Constants.SERVICE_INFO_SPLITER)[1];
    }

    public static String getGroupName(String serviceNameWithGroup) {
        if (!serviceNameWithGroup.contains(Constants.SERVICE_INFO_SPLITER)) {
            return Constants.DEFAULT_GROUP;
        }
        return serviceNameWithGroup.split(Constants.SERVICE_INFO_SPLITER)[0];
    }
}
</code></pre>
<p>ä» <code>NamingUtils</code> å¯ä»¥çœ‹å‡ºï¼Œè¿”å›å‰å°ç•Œé¢çš„æ—¶å€™è¦å°†åˆå¹¶çš„æ•°æ®ï¼ŒæŒ‰<code>@@</code> åˆ†å‰²äº†ï¼Œè·å–åˆ°æœåŠ¡å¯¹åº”çš„ groupã€‚</p>
<p>æœ€åçœ‹ä¸‹å­˜å…¥ service ä¿¡æ¯çš„æ—¶å€™ï¼Œæ˜¯å¦å¦‚æ‰€é¢„æƒ³çš„é‚£æ ·ï¼Œservice çš„ name å’Œ group åˆå¹¶åæ²¡æœ‰åšå¤„ç†çš„ã€‚<br>
<code>com.alibaba.nacos.naming.core.ServiceManager</code></p>
<pre><code>    public void putService(Service service) {
        if (!serviceMap.containsKey(service.getNamespaceId())) {
            synchronized (putServiceLock) {
                if (!serviceMap.containsKey(service.getNamespaceId())) {
                    serviceMap.put(service.getNamespaceId(), new ConcurrentHashMap&lt;&gt;(16));
                }
            }
        }
        // å¯ä»¥çœ‹åˆ°å­˜å…¥ service çš„æ—¶å€™ï¼Œåå­—æ²¡æœ‰åšå¤„ç†
        serviceMap.get(service.getNamespaceId()).put(service.getName(), service);
    }
</code></pre>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>nacos çš„æœåŠ¡å¯ä»¥åˆ†ç»„ï¼Œå¦‚æ–‡æ¡£æ‰€è¯´ï¼Œæ¨¡å‹æ˜¯ service --&gt; cluster --&gt; insttanceï¼Œcluster å°±æ˜¯ä»£ç ä¸­çš„ groupã€‚åœ¨å®é™…çš„ä»£ç å±‚é¢ä¸Šå¤„ç†çš„æ—¶å€™ï¼Œæ˜¯å°† service å’Œ cluster åˆå¹¶æˆä¸€ä¸ªå±æ€§ï¼Œç”¨ <code>@@</code> åšåˆ†å‰²ã€‚</p>
<pre><code class="language-java">/**
 * Service of Nacos server side
 * &lt;p&gt;
 * We introduce a 'service --&gt; cluster --&gt; instance' model, in which service stores a list of clusters,
 * which contain a list of instances.
 * &lt;p&gt;
 * This class inherits from Service in API module and stores some fields that do not have to expose to client.
 *
 * @author nkorange
 */
</code></pre>
<p>è¿™é‡Œæ‰¾åˆ°æœåŠ¡åˆ é™¤ä¸æ‰ï¼ŒåŸå› å°±æ˜¯å‰é¢æ‰€è¯´çš„ï¼Œæˆ‘ä¹‹å‰æµ‹è¯•çš„æ—¶å€™ï¼Œå‡ºäºä¸€äº›åŸå› ï¼ˆæ†¨ï¼‰ï¼Œåœ¨æ³¨å†ŒæœåŠ¡çš„æ—¶å€™<br>
<code>com.alibaba.nacos.api.naming.NamingService#registerInstance(java.lang.String, com.alibaba.nacos.api.naming.pojo.Instance)</code><br>
æ³¨å†Œçš„æœåŠ¡çš„åå­—åé¢å¸¦ä¸Šäº†<code>@@</code>ï¼Œå‰å°å±•ç¤ºçš„æ—¶å€™ï¼Œ<code>@@</code> ç”±äºå­—ç¬¦ä¸²è¢«å»æ‰äº†ï¼Œä½†æ˜¯ nacos ä¸Šå­˜å–æœåŠ¡å®ä¾‹çš„ map ä¸­çš„åç§°ä¸­å®é™…ä¸Šå¸¦æœ‰æˆ‘æ·»åŠ çš„ <code>@@</code>ï¼Œåˆ é™¤çš„æ—¶å€™å°±å¤±è´¥äº†ï¼Œå› ä¸ºæ ¹æ®æœåŠ¡ name æŸ¥æ‰¾ä¸åˆ°ï¼ˆå®é™…çš„ name å¤šäº† <code>@@</code> åç¼€ï¼‰ã€‚</p>
<p>åå°ç•Œé¢ä¸Šå‡ºç°ä¸¤ä¸ªåŒåçš„æœåŠ¡çš„åŸå› ä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªï¼Œåªæ˜¯æ˜¾ç¤ºçš„æœåŠ¡åç§°ç›¸åŒï¼Œå®é™…ä¸Šæ˜¯ä¸¤ä¸ªä¸åŒçš„æœåŠ¡ã€‚</p>
<p>ä¸ºä»€ä¹ˆ nacos åœ¨è¿”å› service çš„æ—¶å€™è¦å°†<code>@@</code> å»æ‰ï¼Œç”±å‰æ‰€è¿°å› ä¸º group å’Œ serviceNameï¼Œè¿”å›çš„æ—¶å€™è¦æŠŠåˆå¹¶çš„å­—ç¬¦ï¼Œè¿˜åŸå›å»ã€‚</p>
<p>éšåæŸ¥çœ‹äº†ä¸‹ nacos ä¸­æ˜¯æœ‰åšå­—ç¬¦æ£€æµ‹çš„ï¼Œä½†æ˜¯æ­£åˆ™å†™çš„æœ‰é—®é¢˜ã€‚ã€‚<br>
<code>com.alibaba.nacos.naming.core.Service#validate</code>ï¼Œ<br>
<code>com.alibaba.nacos.naming.core.Service#SERVICE_NAME_SYNTAX</code></p>
<pre><code class="language-java">    private static final String SERVICE_NAME_SYNTAX = &quot;[0-9a-zA-Z@\\.:_-]+&quot;;
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[é›¨ä¸­æ³ªæ°´ç‹¬ç™½ï¼ˆTears in rain monologueï¼‰]]></title>
        <id>https://jiangjinxinn.github.io/post/yu-zhong-lei-shui-du-bai-tears-in-rain-monologue/</id>
        <link href="https://jiangjinxinn.github.io/post/yu-zhong-lei-shui-du-bai-tears-in-rain-monologue/">
        </link>
        <updated>2019-10-09T16:18:17.000Z</updated>
        <content type="html"><![CDATA[<p>â€œ	è‹±è¯­ï¼šI've seen things you people wouldn't believe. Attack ships on fire off the shoulder of Orion. I watched C-beams glitter in the dark near the TannhÃ¤user Gate. All those moments will be lost in time, like tears in rain. Time to die.	â€</p>
<p>ï¼ˆæˆ‘æ›¾è§è¿‡ä»¤ä½ ä»¬äººç±»éš¾ä»¥ç½®ä¿¡çš„äº‹æƒ…ã€‚æˆ‘çœ‹åˆ°è¿‡æˆ˜èˆ°åœ¨çŒæˆ·åº§è‚©æ—ç†Šç†Šç‡ƒçƒ§ï¼Œä¹Ÿæ›¾çœ‹åˆ°ï¼£å°„çº¿åœ¨å”æ€€ç‘Ÿä¹‹é—¨æ—çš„é»‘æš—é‡Œé—ªè€€ã€‚æ‰€æœ‰çš„é‚£äº›æ—¶åˆ»ï¼Œéƒ½å°†æ¶ˆé€åœ¨æ—¶å…‰ä¸­ï¼Œä¸€å¦‚æ³ªæ°´ï¼Œæ¶ˆå¤±åœ¨é›¨ä¸­ã€‚æ­»äº¡çš„æ—¶åˆ»åˆ°äº†ã€‚ï¼‰</p>
<p><a href="https://zh.wikipedia.org/wiki/%E9%9B%A8%E4%B8%AD%E6%B3%AA%E6%B0%B4%E7%8B%AC%E7%99%BD#cite_note-4">wikipedia</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Shading-JDBC]]></title>
        <id>https://jiangjinxinn.github.io/post/shading-jdbc/</id>
        <link href="https://jiangjinxinn.github.io/post/shading-jdbc/">
        </link>
        <updated>2019-10-06T13:42:56.000Z</updated>
        <content type="html"><![CDATA[<h2 id="æµç¨‹">æµç¨‹</h2>
<p>åšåœ¨ jdbc å±‚é¢ä¸Š</p>
<h2 id="åˆ†åº“åˆ†è¡¨ç­–ç•¥">åˆ†åº“åˆ†è¡¨ç­–ç•¥</h2>
<ul>
<li>å‚ç›´</li>
<li>æ°´å¹³</li>
<li>
<ul>
<li>ç»‘å®šè¡¨</li>
</ul>
</li>
</ul>
<h2 id="åˆ†ç‰‡">åˆ†ç‰‡</h2>
<h3 id="æ–°å¢">æ–°å¢</h3>
<h2 id="è¡Œè¡¨è¾¾å¼">è¡Œè¡¨è¾¾å¼</h2>
<p>å®ç°åŠ¨æœºï¼šé…ç½®çš„ç®€åŒ–ä¸ä¸€ä½“åŒ–<br>
è¯­æ³•ï¼šä½¿ç”¨ Groovy</p>
<p>sql between æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸<code>org.springframework.dao.InvalidDataAccessApiUsageException: Inline strategy cannot support range sharding.; nested exception is java.lang.IllegalStateException: Inline strategy cannot support range sharding.</code></p>
<h2 id="åˆ†å¸ƒå¼-id-ç”Ÿæˆ">åˆ†å¸ƒå¼ id ç”Ÿæˆ</h2>
<h3 id="é›ªèŠ±ç®—æ³•é»˜è®¤">é›ªèŠ±ç®—æ³•ï¼ˆé»˜è®¤ï¼‰</h3>
<p><img src="https://jiangjinxinn.github.io//post-images/1570369804031.png" alt="" loading="lazy"><br>
Sharding-JDBC ä¸­ç”Ÿæˆåæ’å…¥æ•°æ®åº“ä¸­ã€‚</p>
<ol>
<li>æ—¶é’Ÿå›æ‹¨<br>
æœåŠ¡å™¨æ—¶é’Ÿå›æ‹¨ä¼šå¯¼è‡´äº§ç”Ÿé‡å¤åºåˆ—ï¼Œå› æ­¤é»˜è®¤åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨æä¾›äº†ä¸€ä¸ªæœ€å¤§å®¹å¿çš„æ—¶é’Ÿå›æ‹¨æ¯«ç§’ æ•°ã€‚ å¦‚æœæ—¶é’Ÿå›æ‹¨çš„æ—¶é—´è¶…è¿‡æœ€å¤§å®¹å¿çš„æ¯«ç§’æ•°é˜ˆå€¼ï¼Œåˆ™ç¨‹åºæŠ¥é”™ï¼›å¦‚æœåœ¨å¯å®¹å¿çš„èŒƒå›´å†…ï¼Œé»˜è®¤åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ä¼šç­‰å¾…æ—¶é’ŸåŒæ­¥åˆ°æœ€åä¸€æ¬¡ä¸»é”®ç”Ÿæˆçš„æ—¶é—´åå†ç»§ç»­å·¥ä½œã€‚ æœ€å¤§å®¹å¿çš„æ—¶é’Ÿå›æ‹¨æ¯«ç§’æ•°çš„é»˜è®¤å€¼ä¸º0ï¼Œå¯é€šè¿‡å±æ€§è®¾ç½®ã€‚<br>
https://www.jianshu.com/p/98c202f64652</li>
<li>worker id<br>
é‡å¤ worker id ä¼šäº§ç”Ÿç›¸åŒçš„ id https://cloud.tencent.com/developer/article/1074907<br>
worker id å¦‚ä½•é…ç½®ï¼Ÿ</li>
<li>æ²¡æœ‰å¹¶å‘é‡çš„æƒ…å†µä¸‹çš„è¯ï¼Œåºåˆ—å·ä½å‡ ä¹éƒ½æ˜¯ 1ï¼Œæ ¹æ®è·¯ç”±è§„åˆ™éƒ½ä¼šè·¯ç”±åˆ°ä¸€ä¸ªè¡¨ä¸­</li>
</ol>
<h2 id="åˆ†å¸ƒå¼äº‹åŠ¡">åˆ†å¸ƒå¼äº‹åŠ¡</h2>
<p>æœ¬åœ°äº‹åŠ¡ï¼šACID<br>
åˆ†å¸ƒå¼äº‹åŠ¡ï¼šBASEï¼Œé€šè¿‡ä¸šåŠ¡é€»è¾‘å°†äº’æ–¥æ“ä½œä»èµ„æºå±‚é¢ä¸Šç§»è‡³ä¸šåŠ¡å±‚é¢ã€‚é€šè¿‡æ”¾å®½å¯¹å¼ºä¸€è‡´æ€§è¦æ±‚ï¼Œæ¥æ¢å–ç³»ç»Ÿååé‡çš„æå‡</p>
<h3 id="xa">XA</h3>
<p><img src="https://jiangjinxinn.github.io//post-images/1570501311460.png" alt="" loading="lazy"><br>
ä¸¤é˜¶æ®µäº‹åŠ¡æäº¤é‡‡ç”¨X/OPENç»„ç»‡å®šä¹‰çš„DTP æ¨¡å‹ï¼Œé€šè¿‡æŠ½è±¡å‡ºæ¥çš„APã€TMã€RM çš„æ¦‚å¿µå¯ä»¥ä¿è¯äº‹åŠ¡çš„å¼ºä¸€è‡´æ€§ã€‚å…¶ä¸­ TM å’Œ RM ä¹‹é—´é‡‡ç”¨ XA åè®®è¿›è¡ŒåŒå‘é€šä¿¡ã€‚ä¸ä¼ ç»Ÿçš„æœ¬åœ°äº‹åŠ¡ç›¸æ¯”ï¼ŒXA äº‹åŠ¡å¢åŠ äº† prepare é˜¶æ®µï¼Œæ•°æ®åº“é™¤äº†è¢«åŠ¨æ¥å—æäº¤æŒ‡ä»¤ä»¥å¤–ï¼Œè¿˜å¯ä»¥åå‘é€šçŸ¥è°ƒç”¨æ–¹äº‹åŠ¡æ˜¯å¦å¯ä»¥è¢«æäº¤ã€‚å› æ­¤ TMå¯ä»¥æ”¶é›†å„åˆ†æ”¯äº‹åŠ¡çš„prepare ç»“æœï¼Œæœ€åè¿›è¡ŒåŸå­æäº¤ï¼Œä¿è¯äº‹åŠ¡çš„å¼ºä¸€è‡´æ€§ã€‚<br>
åˆ†ä¸ºå‡†å¤‡é˜¶æ®µå’Œæäº¤é˜¶æ®µã€‚æ¯ä¸ªå‚ä¸è€…è¦ä¹ˆå‘é€å¤±è´¥ï¼Œè¦ä¹ˆåœ¨æœ¬åœ°æ‰§è¡Œäº‹åŠ¡ï¼Œå†™æœ¬åœ°çš„ redoã€undo æ—¥å¿—ï¼Œä½†ä¸æäº¤ã€‚åè°ƒè€…æ”¶åˆ°äº†å‚ä¸è€…å¤±è´¥æ¶ˆæ¯æˆ–è€…è¶…æ—¶æ¶ˆæ¯ï¼Œç›´æ¥ç»™æ¯ä¸ªå‚ä¸è€…å‘é€å›æ»šï¼ˆrollbackï¼‰æ¶ˆæ¯ï¼Œå¦åˆ™å‘é€æäº¤ï¼ˆcommitï¼‰æ¶ˆæ¯ã€‚<br>
éœ€è¦åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œåè°ƒï¼Œè€Œå„èŠ‚ç‚¹å¯¹é”èµ„æºçš„é‡Šæ”¾å¿…é¡»ç­‰åˆ°äº‹åŠ¡æœ€ç»ˆæäº¤çš„æ—¶å€™ã€‚è¿™æ ·æ¯”èµ·å•é˜¶æ®µæäº¤ï¼Œä¼šæ¶ˆè€—æ›´å¤šæ—¶é—´ã€‚äº‹åŠ¡æ‰§è¡Œæ—¶é—´å»¶é•¿ï¼Œæ„å‘³ç€é”èµ„æºå‘ç”Ÿå†²çªçš„æ¦‚ç‡å¢åŠ ã€‚</p>
<h3 id="saga">Saga</h3>
<p>å¤šä¸ªçŸ­æ—¶äº‹åŠ¡ç»„æˆçš„é•¿æ—¶äº‹åŠ¡ï¼Œåœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬æŠŠä¸€ä¸ª Saga åˆ†å¸ƒå¼äº‹åŠ¡çœ‹åšä¸€ä¸ªç”±å¤šä¸ªæœ¬åœ°äº‹åŠ¡ç»„æˆçš„äº‹åŠ¡ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„è¡¥å¿äº‹åŠ¡ã€‚åœ¨ Saga äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŸä¸€ä¸ªå‡ºé”™åï¼ŒSaga äº‹åŠ¡ä¼šç»ˆæ­¢ï¼ŒåŒæ—¶ä¼šè°ƒç”¨å¯¹åº”çš„è¡¥å¿äº‹åŠ¡å®Œæˆç›¸å…³çš„æ¢å¤æ“ä½œ<br>
è‡ªåŠ¨åå‘è¡¥å¿ã€‚Saga å®šä¹‰äº†ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ¯ä¸ªå­äº‹åŠ¡éƒ½å¯¹åº”ä¸€ä¸ªåå‘è¡¥å¿æ“ä½œã€‚Saga äº‹åŠ¡ç®¡ç†å™¨ä¼šæ ¹æ®æ‰§è¡Œç»“æœç”Ÿæˆä¸€å¼ æœ‰å‘æ— ç¯å›¾ï¼Œå¹¶åœ¨æ‰§è¡Œå›æ»šçš„æ—¶å€™æ ¹æ®è¯¥å›¾ä¸€æ¬¡æ‰§è¡Œåå‘è¡¥å¿æ“ä½œã€‚Saga äº‹åŠ¡ç®¡ç†å™¨åªç”¨äºä½•æ—¶é‡è¯•ï¼Œä½•æ—¶è¡¥å¿ï¼Œä¸è´Ÿè´£è¡¥å¿çš„å†…å®¹ï¼Œè¡¥å¿çš„å…·ä½“æ“ä½œç”±å¼€å‘è€…è‡ªè¡Œæä¾›ã€‚<br>
Sharding-JDBC é‡‡ç”¨äº†åå‘ sql æŠ€æœ¯ï¼Œå°†å¯¹æ•°æ®åº“çš„æ›´æ–°æ“ä½œçš„ sql è‡ªåŠ¨ç”Ÿæˆåå‘ sqlï¼Œå¹¶äº¤ç”± <a href="https://github.com/apache/servicecomb-saga-actuator">saga-actuator</a> æ‰§è¡Œã€‚</p>
<h3 id="seate">Seate</h3>
<p><a href="https://github.com/seata/seata">Seate</a><br>
<a href="https://shardingsphere.apache.org/document/current/cn/features/transaction/principle/base-transaction-seata/">Sharding-JDBC çš„å®ç°åŸç†</a>ã€‚æ•´åˆSeata ATäº‹åŠ¡æ—¶ï¼Œéœ€è¦æŠŠTMï¼ŒRMï¼ŒTCçš„æ¨¡å‹èå…¥åˆ°ShardingSphere åˆ†å¸ƒå¼äº‹åŠ¡çš„SPIçš„ç”Ÿæ€ä¸­ã€‚åœ¨æ•°æ®åº“èµ„æºä¸Šï¼ŒSeataé€šè¿‡å¯¹æ¥ DataSource æ¥å£ï¼Œè®©JDBCæ“ä½œå¯ä»¥åŒ TC è¿›è¡Œ RPC é€šä¿¡ã€‚åŒæ ·ï¼ŒShardingSphere ä¹Ÿæ˜¯é¢å‘ DataSource æ¥å£å¯¹ç”¨æˆ·é…ç½®çš„ç‰©ç† DataSource è¿›è¡Œäº†èšåˆï¼Œå› æ­¤æŠŠç‰©ç† DataSource äºŒæ¬¡åŒ…è£…ä¸º Seata çš„ DataSource åï¼Œå°±å¯ä»¥æŠŠ Seata AT äº‹åŠ¡èå…¥åˆ° ShardingSphere çš„åˆ†ç‰‡ä¸­ã€‚</p>
]]></content>
    </entry>
</feed>